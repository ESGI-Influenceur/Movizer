{% extends 'base.html.twig' %}
{% block body %}
    <div class="fiche" style="background-image: url('https://image.tmdb.org/t/p/original{{ tv.backdropPath }}')">
        <div class="ficher-overlay">
        </div>
        <div class="container py-6">
            <div class="fiche-content">
                <div class="poster d-none d-sm-block">
                    <img class="poster-image" src="https://image.tmdb.org/t/p/original{{ tv.posterPath }}">
                </div>
                <div class="description px-5">
                    <h1 class="description-title">{{ tv.name }}</h1>
                    <div class="mb-4">
                        {% for genre in tv.genres %}
                            <span class="tag tag-rounded px-3 mr-1 mb-1">{{ genre.name }}</span>
                        {#<% end %>#}
                        {% endfor %}
                    </div>
                    <div class="row my-4">
                        <div class="col-md-6 d-flex">
                            <div id="chart"></div>
                        </div>

                       {# #}{#<% if user_signed_in? %>#}{#
                        {% if app.user %}
                            <div class="col-md-6 d-flex">
                                <div id="star-rating"></div>
                            </div>
                        #}{#<% end%>#}{#
                        {% endif %}#}
                    </div>
                    <h3>Synopsis</h3>
                    <div class="text-muted">
                        {{ tv.overview }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="my-3 my-md-5">
        <div class="container ">
            <div class="row">
                <div class="col-lg-4 col-md-8  col-sm-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Informations</h3>
                        </div>
                        <div class="card-body">
                            <div class="media mb-5">
                                <img class="d-flex mr-5 rounded w-50" src="https://image.tmdb.org/t/p/original/{{ tv.posterPath }}">
                                <div class="media-body">
                                    <h5>{{ tv.name }}</h5>
                                    <h6 class="text-muted">{{ tv.firstAirDate | date('j F Y') }}</h6>
                                    <div class="text-muted small">
                                        Titre Original : {{ tv.originalName }}
                                    </div>
                                    {% if app.user %}
                                        {% if app.user in tv.favoriteUsers %}
                                            <a href="{{ path('remove_favoris_tv', { 'id': tv.id }) }}" class="btn btn-sm btn-danger">
                                                <i class="fe fe-heart mr-2"></i>You Like It
                                            </a>
                                        {% else %}
                                            <a href="{{ path('favoris_tv', { 'id': tv.id }) }}" class="btn btn-sm btn-outline-danger">
                                                <i class="fe fe-heart mr-2"></i>Like It
                                            </a>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <div class="h6">Pays d'origine</div>
                                    <p><i class="flag flag-{{ tv.originCountry | lower }}"></i></p>
                                </div>
                                <div class="col-6">
                                    <div class="h6">Note Moyenne</div>
                                    <p>{{ tv.averageNote }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8 col-md-10 col-sm-12 mx-auto">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Commentaire</h3>
                        </div>
                        <ul class="list-group card-list-group" id="listCom">
                            {% if tv.comments|length > 0 %}
                                {% for comment in tv.comments %}
                                    <li class="list-group-item py-5">
                                        <div class="media">
                                            <div class="mr-4" >
                                                <span class="avatar avatar-md avatar-green">{{ comment.commentUser.username|slice(0,2)|upper }}</span>
                                            </div>
                                            <div class="media-body">
                                                <div class="media-heading">
                                                    <small class="float-right text-muted">{{ comment.createdAt|date('d/m/Y')}}</small>
                                                    {#<% if can? :destroy, comment%>
                                                    <button type="button" class="float-right btn btn-icon btn-primary btn-danger"><i class="fe fe-trash"></i></button>
                                                    <% end %>#}
                                                    <h5>{{ comment.commentUser.username }}</h5>
                                                </div>
                                                <div>
                                                    {{ comment.content }}
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                {% endfor %}
                            {% else %}
                                <li class="list-group-item py-5">
                                    <div class="media">
                                        <div class="media-body">
                                            <div>
                                                Soyez le premier Ã  commenter !
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            {% endif %}
                        </ul>

                        {% if app.user %}
                            {{ form_start(commentForm) }}
                            <div class="card-footer">
                                <div class="form-group mb-0">
                                    <label class="form-label">Mon Commentaire</label>
                                    {{ form_widget(commentForm.content, {'attr': {'placeholder': 'Ici votre commentaire'} }) }}
                                </div>
                            </div>
                            <div class="card-footer text-right">
                                {{ form_widget(commentForm.submit, {'label' : 'Poster mon commentaire'}) }}
                            </div>
                            {{ form_end(commentForm) }}
                        {% endif %}

                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}